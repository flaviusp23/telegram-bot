<!DOCTYPE html>
<html>
<head>
    <title>Test Admin Auth</title>
</head>
<body>
    <h1>Admin Auth Test</h1>
    <button onclick="testLogin()">1. Test Login</button>
    <button onclick="testDashboard()">2. Test Dashboard</button>
    <button onclick="checkToken()">3. Check Token</button>
    <div id="result"></div>

    <script>
    async function testLogin() {
        const response = await fetch('http://127.0.0.1:8000/api/v1/auth/login', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({
                username: 'admin',
                password: 'admin123'
            })
        });
        
        const data = await response.json();
        
        if (response.ok) {
            localStorage.setItem('access_token', data.access_token);
            localStorage.setItem('refresh_token', data.refresh_token);
            document.getElementById('result').innerHTML = `
                <h3>Login Success!</h3>
                <p>Access Token: ${data.access_token.substring(0, 50)}...</p>
                <p>Stored in localStorage</p>
            `;
        } else {
            document.getElementById('result').innerHTML = `<h3>Login Failed: ${data.detail}</h3>`;
        }
    }

    async function testDashboard() {
        const token = localStorage.getItem('access_token');
        if (!token) {
            document.getElementById('result').innerHTML = '<h3>No token found! Login first.</h3>';
            return;
        }

        const response = await fetch('http://127.0.0.1:8000/api/v1/analytics/dashboard', {
            headers: {
                'Authorization': `Bearer ${token}`
            }
        });
        
        if (response.ok) {
            const data = await response.json();
            document.getElementById('result').innerHTML = `
                <h3>Dashboard Data Loaded!</h3>
                <pre>${JSON.stringify(data, null, 2)}</pre>
            `;
        } else {
            document.getElementById('result').innerHTML = `<h3>Dashboard Failed: ${response.status} ${response.statusText}</h3>`;
        }
    }

    function checkToken() {
        const token = localStorage.getItem('access_token');
        document.getElementById('result').innerHTML = token ? 
            `<h3>Token Found:</h3><p>${token.substring(0, 50)}...</p>` : 
            '<h3>No token in localStorage</h3>';
    }
    </script>
</body>
</html>